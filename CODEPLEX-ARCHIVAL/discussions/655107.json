[
  {
    "Id": "1474762",
    "ThreadId": "655107",
    "Html": "Hello,\r<br />\n<br />\nI would like to propose some additional options for this utility.\r<br />\n<br />\nI frequently use this tool from remote computers, and since upgrading to windows 10 on my workstation, I was no longer able to publish remotely due to version mismatch.\r<br />\n<br />\nI have found a workaround to this, and it seems to work in my environment with no issues.\r<br />\n<br />\nI have also found a method by which you can make published updates visible in the wsus console without direct database access.\r<br />\n<br />\nI have linked an example solution which makes use of both of these workarounds <a href=\"https://www.sendspace.com/file/hzfn4b\" rel=\"nofollow\">HERE - https://www.sendspace.com/file/hzfn4b</a>\r<br />\n<br />\nIncluded below are the relevant bits from the provided solution in case the download link goes missing.<br />\n<div style=\"color:Black;background-color:White;\"><pre>\r\n<span style=\"color:Blue;\">using</span> System;\n<span style=\"color:Blue;\">using</span> System.IO;\n<span style=\"color:Blue;\">using</span> System.Reflection;\n<span style=\"color:Blue;\">using</span> System.Xml;\n<span style=\"color:Blue;\">using</span> System.Xml.Xsl;\n<span style=\"color:Blue;\">using</span> Microsoft.UpdateServices.Internal;\n<span style=\"color:Blue;\">using</span> Microsoft.UpdateServices.Internal.BaseApi;\n<span style=\"color:Blue;\">using</span> Microsoft.UpdateServices.Internal.DatabaseAccess;\n\n<span style=\"color:Blue;\">namespace</span> UpdateServicesNonLocalPublisher\n{\n    <span style=\"color:Blue;\">public</span> <span style=\"color:Blue;\">class</span> AdminDataAccessProxyProxy : AdminDataAccessProxy\n    {\n        <span style=\"color:Blue;\">private</span> <span style=\"color:Blue;\">static</span> <span style=\"color:Blue;\">readonly</span> XslCompiledTransform removeLocallyPublishedTransform = <span style=\"color:Blue;\">new</span> XslCompiledTransform();\n\n        <span style=\"color:Blue;\">static</span> AdminDataAccessProxyProxy()\n        {\n            removeLocallyPublishedTransform.Load(<span style=\"color:#A31515;\">&quot;TranslateSusToNonLocalPublish.xslt&quot;</span>);\n        }\n\n        <span style=\"color:Blue;\">public</span> AdminDataAccessProxyProxy(UpdateServer updateServer) : <span style=\"color:Blue;\">base</span>(updateServer)\n        {\n        }\n\n        <span style=\"color:Blue;\">public</span> <span style=\"color:Blue;\">override</span> <span style=\"color:Blue;\">void</span> ImportUpdateForPublishing(<span style=\"color:Blue;\">string</span> susXml, <span style=\"color:Blue;\">string</span> uspXml, ServerSyncUrlData[] urlData, <span style=\"color:Blue;\">bool</span> sdpOnly)\n        {\n            <span style=\"color:Blue;\">using</span> (<span style=\"color:Blue;\">var</span> reader = XmlReader.Create(<span style=\"color:Blue;\">new</span> StringReader(susXml)))\n            {\n                <span style=\"color:Blue;\">using</span> (<span style=\"color:Blue;\">var</span> output = <span style=\"color:Blue;\">new</span> StringWriter())\n                <span style=\"color:Blue;\">using</span> (<span style=\"color:Blue;\">var</span> writer = XmlWriter.Create(output))\n                {\n                    removeLocallyPublishedTransform.Transform(reader, writer);\n                    susXml = output.ToString();\n                }\n            }\n\n            <span style=\"color:Blue;\">base</span>.ImportUpdateForPublishing(susXml, uspXml, urlData, sdpOnly);\n        }\n    }\n\n    <span style=\"color:Blue;\">class</span> Program\n    {\n        <span style=\"color:Blue;\">static</span> <span style=\"color:Blue;\">void</span> Main(<span style=\"color:Blue;\">string</span>[] args)\n        {\n            <span style=\"color:Blue;\">var</span> versionField = <span style=\"color:Blue;\">typeof</span>(UpdateServer).GetField(<span style=\"color:#A31515;\">&quot;version&quot;</span>, BindingFlags.NonPublic | BindingFlags.GetField | BindingFlags.Instance);\n            <span style=\"color:Blue;\">var</span> adminDataAccessProxyTypeField = <span style=\"color:Blue;\">typeof</span>(ClassFactory).GetField(<span style=\"color:#A31515;\">&quot;adminDataAccessProxyType&quot;</span>, BindingFlags.NonPublic | BindingFlags.GetField | BindingFlags.Static);\n\n            <span style=\"color:Green;\">// set DataAccessProxy to modify xml on the fly</span>\n            adminDataAccessProxyTypeField.SetValue(<span style=\"color:Blue;\">null</span>, <span style=\"color:Blue;\">typeof</span>(AdminDataAccessProxyProxy));\n\n            <span style=\"color:Green;\">// get update server</span>\n            <span style=\"color:Blue;\">var</span> server = Microsoft.UpdateServices.Administration.AdminProxy.GetUpdateServer(<span style=\"color:#A31515;\">&quot;wsus&quot;</span>, <span style=\"color:Blue;\">true</span>, 8531) <span style=\"color:Blue;\">as</span> UpdateServer;\n\n            <span style=\"color:Green;\">// backup original version</span>\n            <span style=\"color:Blue;\">var</span> origServerVersion = server.Version;\n\n            <span style=\"color:Green;\">// patch version, get publisher, restore original version</span>\n            versionField.SetValue(server, ProductVersion.Version);\n            <span style=\"color:Blue;\">var</span> publisher = server.GetPublisher(<span style=\"color:#A31515;\">@&quot;package.xml&quot;</span>) <span style=\"color:Blue;\">as</span> Publisher;\n            versionField.SetValue(server, origServerVersion);\n\n            <span style=\"color:Green;\">// publish package</span>\n            publisher.PublishSignedPackage(<span style=\"color:#A31515;\">@&quot;package.cab&quot;</span>, <span style=\"color:Blue;\">null</span>);\n\n\n            Console.ReadLine();\n        }\n    }\n}\r\n</pre></div>Below is the XML transform file: TranslateSusToNonLocalPublish.xslt<br />\n<div style=\"color:Black;background-color:White;\"><pre>\r\n<span style=\"color:Blue;\">&lt;?</span><span style=\"color:#A31515;\">xml</span> <span style=\"color:Red;\">version</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">1.0</span><span style=\"color:Black;\">&quot;</span> <span style=\"color:Red;\">encoding</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">utf-8</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">?&gt;</span>\n<span style=\"color:Blue;\">&lt;</span><span style=\"color:#A31515;\">xsl</span><span style=\"color:Blue;\">:</span><span style=\"color:#A31515;\">stylesheet</span>\n    <span style=\"color:Red;\">version</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">1.0</span><span style=\"color:Black;\">&quot;</span>\n    <span style=\"color:Red;\">xmlns:xsl</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">http://www.w3.org/1999/XSL/Transform</span><span style=\"color:Black;\">&quot;</span>\n    <span style=\"color:Red;\">xmlns:upd</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">http://schemas.microsoft.com/msus/2002/12/Update</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">&gt;</span>\n  <span style=\"color:Blue;\">&lt;</span><span style=\"color:#A31515;\">xsl</span><span style=\"color:Blue;\">:</span><span style=\"color:#A31515;\">output</span> <span style=\"color:Red;\">encoding</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">utf-8</span><span style=\"color:Black;\">&quot;</span> <span style=\"color:Red;\">method</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">xml</span><span style=\"color:Black;\">&quot;</span> <span style=\"color:Red;\">indent</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">yes</span><span style=\"color:Black;\">&quot;</span> <span style=\"color:Blue;\">/&gt;</span>\n\n  <span style=\"color:Blue;\">&lt;</span><span style=\"color:#A31515;\">xsl</span><span style=\"color:Blue;\">:</span><span style=\"color:#A31515;\">template</span> <span style=\"color:Red;\">match</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">@* | node()</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">&gt;</span>\n    <span style=\"color:Blue;\">&lt;</span><span style=\"color:#A31515;\">xsl</span><span style=\"color:Blue;\">:</span><span style=\"color:#A31515;\">copy</span><span style=\"color:Blue;\">&gt;</span>\n      <span style=\"color:Blue;\">&lt;</span><span style=\"color:#A31515;\">xsl</span><span style=\"color:Blue;\">:</span><span style=\"color:#A31515;\">apply-templates</span> <span style=\"color:Red;\">select</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">@* | node()</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">/&gt;</span>\n    <span style=\"color:Blue;\">&lt;/</span><span style=\"color:#A31515;\">xsl</span><span style=\"color:Blue;\">:</span><span style=\"color:#A31515;\">copy</span><span style=\"color:Blue;\">&gt;</span>\n  <span style=\"color:Blue;\">&lt;/</span><span style=\"color:#A31515;\">xsl</span><span style=\"color:Blue;\">:</span><span style=\"color:#A31515;\">template</span><span style=\"color:Blue;\">&gt;</span>\n\n  <span style=\"color:Blue;\">&lt;</span><span style=\"color:#A31515;\">xsl</span><span style=\"color:Blue;\">:</span><span style=\"color:#A31515;\">template</span> <span style=\"color:Red;\">match</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">upd:Update/upd:Properties/@IsLocallyPublished</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">&gt;</span>\n    <span style=\"color:Blue;\">&lt;</span><span style=\"color:#A31515;\">xsl</span><span style=\"color:Blue;\">:</span><span style=\"color:#A31515;\">attribute</span> <span style=\"color:Red;\">name</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">IsLocallyPublished</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">&gt;</span>false<span style=\"color:Blue;\">&lt;/</span><span style=\"color:#A31515;\">xsl</span><span style=\"color:Blue;\">:</span><span style=\"color:#A31515;\">attribute</span><span style=\"color:Blue;\">&gt;</span>\n  <span style=\"color:Blue;\">&lt;/</span><span style=\"color:#A31515;\">xsl</span><span style=\"color:Blue;\">:</span><span style=\"color:#A31515;\">template</span><span style=\"color:Blue;\">&gt;</span>\n<span style=\"color:Blue;\">&lt;/</span><span style=\"color:#A31515;\">xsl</span><span style=\"color:Blue;\">:</span><span style=\"color:#A31515;\">stylesheet</span><span style=\"color:Blue;\">&gt;</span>\r\n</pre></div>the XML transform and AdminDataAccessProxyProxy class are for making published packages visible in the console. (Just be aware that if a category/product/vendor already exist in the database they do need to be manually made visible, or deleted first).\r<br />\n<br />\nThe versionField is for bypassing version mismatch errors.\r<br />\n<br />\nThese two features would be very nice to have (optional features of course), and when disabled would cause no risk.\r<br />\n<br />\nThanks,\r<br />\nAustin Morton<br />\n",
    "PostedDate": "2016-05-31T13:18:08.647-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]